<!DOCTYPE html>
<html>
<head>
	
	<title>New York Explorer</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <link rel="stylesheet" type="text/css" href="style.css">
	
</head>
<body>

	<div id="theSidebar" class="sidebar">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
			<details>
			<summary><a href="javascript:void(0)" class="menu" id="city" onclick="changeFeature('city', 0)">NEW YORK CITY</a></summary>
                <ul id="sidebar-city"></ul>
			</details>

            <details>
            <summary><a href="javascript:void(0)" class="menu" id="boroughs" onclick="changeFeature('boroughs', 0)">BOROUGHS</a></summary>
                <ul id="sidebar-boroughs"></ul>
			</details>

			<details>
				<summary><a href="javascript:void(0)" class="menu" id="neighborhoods" onclick="changeFeature('neighborhoods', 0)">NEIGHBORHOODS</a></summary>
				<ul id="sidebar-neighborhoods"></ul>
			</details>

			<details>
				<summary><a href="javascript:void(0)" class="menu" id="streets" onclick="changeFeature('streets', 0)">STREETS</a></summary>
				<ul id="sidebar-streets"></ul>
			</details>

<!-- 		<ul>
            <li><a href="javascript:void(0)" class="menu" id="boroughs" onclick="changeFeature('boroughs')">BOROUGHS</a></li>
            <li><a href="javascript:void(0)" class="menu" id="neighborhoods" onclick="changeFeature('neighborhoods')">NEIGHBORHOODS</a></li>
            <li><a href="javascript:void(0)" class="menu" id="streets" onclick="changeFeature('streets')">STREETS</a></li>
        </ul> -->
	</div>

	<div id="main">
	    <header>
	        <nav>        	
	            <ul id="navbar-left">
	                <li><a href="javascript:void(0)" class="menu" onclick="openNav()"><i class="fa-solid fa-bars"></i></a></li>
	                <!-- NEW YORK STATE -->
	                <li><a href="javascript:void(0)" id="state"></a></li>
<!-- 	                <li><a href="javascript:void(0)" class="menu" id="city" onclick="changeFeature('city')">CITY</a></li>
	                <li><a href="javascript:void(0)" class="menu" id="boro" onclick="changeFeature('boro')">BOROS</a></li>
	                <li><a href="javascript:void(0)" class="menu" id="hood" onclick="changeFeature('hood')">HOODS</a></li>
	                <li><a href="javascript:void(0)" class="menu" id="street" onclick="changeFeature('street')">STREETS</a></li> -->
					<!-- BLOCKS -->
					<!-- BUILDINGS -->
					<!-- LANDMARKS -->
					<!-- THE OTHER ISLANDS OF NYC  -->
					<!-- DONATE -->
					<!-- ABOUT -->
	            </ul>
	            <ul id="navbar-right">
	                <li><a href="javascript:void(0)" class="menu" id="menu-screen"><span class="tooltiptext"><i id="fullscreen-icon" class="fa-solid fa-expand"></i></span></a></li>
	            </ul>
	        </nav>
	    </header>

	    <div id="mapid">
	    	<div id="feature-name"></div>
	        <div class="btn-group"> 
	            <button type="buttons" id="allbus" class="btn btn-success" onclick="clickButton(-1)"><</button>
	            <button type="buttons" id="allbus" class="btn btn-success" onclick="clickButton(1)">></button>
	        </div>
	    </div>
	</div>



    <!-- <script type="text/javascript" src="inverse.js"></script> -->
    <script type="text/javascript" src="data/NYC_boundaries_with_water.js"></script>
    <script type="text/javascript" src="data/boroughs.js"></script>
    <script type="text/javascript" src="data/Wikidata_neighborhoods.js"></script>
    <script type="text/javascript" src="data/dcm_streets_brooklyn_2023_02.js"></script>


    <script>

	const get = element => document.getElementById(element);

	var nycmap = L.map('mapid').setView([40.66, -73.95], 16);

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(nycmap);


	let boros = boroughs; // `boroughs` in boroughs.js
	let hoods = neighborhoods;
	let streets = roads;

	let modes = {"city": {"data": NYC, "featureName": "feature"},
	             "boroughs": {"data": boros, "featureName": "boro_name"},
	             "neighborhoods": {"data": hoods, "featureName": "Name"},
                 "streets": {"data": streets, "featureName": "Street_NM"}};
    
    // console.log(modes[currentMode])

    let modeList = Object.keys(modes)

	let features = ""; 

	// let mapIdObj = {};


	let currentMode = "city";
	let featureIndex = 0;

	let currentFeature = "";
	let currentFeatureGeo = "";
	let currentLayer = "";


function clickButton(n) {
	featureIndex += n;
	m = currentMode;
	changeFeature(m, featureIndex)
}



	function changeFeature(mode, index) {
		// Function employed when clicking on link in sidebar, keyboard prev/next arrow, screen prev/next button

	    // Remove any map markers
	    if (currentLayer != "") {
	        currentLayer.clearLayers(); 
	    };

	    // console.log("This is the mode inside changeFeature: " + mode + "Its type is: " + typeof mode)
		features = modes[mode]["data"].features
	    currentFeature = features[index];

	    if (typeof(currentFeature) == "undefined") {
	    	let nextMode = modeList.indexOf(mode) + 1
	    	currentMode = modeList[nextMode]
	    	featureIndex = 0
	    	changeFeature(currentMode, featureIndex)
	    	return
	    }
        
        let name = modes[mode]["featureName"];
        get("feature-name").innerHTML = currentFeature.properties[name]; 
		currentFeatureGeo = L.geoJSON(currentFeature);
		currentLayer = currentFeatureGeo.addTo(nycmap);
		
		let bounds = currentFeatureGeo.getBounds();
		nycmap.fitBounds(bounds);
		
		let center = bounds.getCenter();
		let lat = center.lat;
		let long = center.lng;
		nycmap.panTo(new L.LatLng(lat, long));
	};

	// function changeMode(currentMode, i=0) {
 //        // mode = m;
 //        features = modes[currentMode]["data"].features; // `streets` in dcm_streets_brooklyn_2023_02.js
 //        changeFeature(i)
	// 	const menu = document.getElementsByClassName("menu")
	// 	Array.prototype.map.call(menu, function(e) {
 // 			e.style.color="whitesmoke";
	// 		e.style.fontWeight="normal";}
	// 		)
 //        get(currentMode).style.color = "red";
 //        get("state").innerHTML = mode.toUpperCase();
	// };

    changeFeature("city", 0);

    function openNav() {
        get("theSidebar").style.width = "400px";
        get("main").style.marginLeft = "400px";
    }

    function closeNav() {
        get("theSidebar").style.width = "0";
        get("main").style.marginLeft= "0";
    }


	// KEYBOARD CONTROLS FOR LAPTOP USE
	// REFERENCE: https://keycode.info/
	function control(e) {
	    if (e.keyCode === 39) { // right key = next image in slideshow
	        // console.log("right key pressed");
	        e.preventDefault(); // supress side-scrolling
	        featureIndex += 1
	        // console.log("currentMode inside next is: " + currentMode + " Its type is " + typeof currentMode)
	        changeFeature(currentMode, featureIndex);
	    } else if (e.keyCode === 37) { // left key = previous image in slideshow
	        e.preventDefault(); // supress side-scrolling
	        changeFeature(currentMode, featureIndex -= 1);
	    } else if (e.keyCode === 83) {
	    	e.preventDefault();
	    	if (get("theSidebar").style.width === "0px") {
                openNav()
	    	} else {
	    		closeNav()
	    	}
	    }
	}
	document.addEventListener('keydown', control); 

	openNav(); // testing purposes; remove later

    function populateSidebar(mode, featureName) {
    	// console.log("populating with" + mode)
        let data = modes[mode].data.features
        let entries = get("sidebar-" + mode)
        for (i = 0; i < data.length; i++) {
            let child = document.createElement("li")
            let displayName = data[i].properties[featureName]
            // console.log(mode)
            child.innerHTML = `<a href="javascript:void(0)" onclick="changeFeature('${mode}', ${i})">${displayName}</a>`
            // `<a href="javascript:void(0)" 
            //                     onclick="index(${i})">${place}</button>`            
            // console.log(child)
            entries.append(child)
        }
    }

    for (m of modeList) {
    	// console.log(m)
    	populateSidebar(m, modes[m].featureName)
    }


</script>



</body>
</html>
